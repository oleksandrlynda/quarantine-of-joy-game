<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="assets/icons/favicon.svg" type="image/svg+xml" />
<meta name="theme-color" content="#0b1220" />
<title>Quarantine of Joy</title>
<link rel="stylesheet" href="styles/styles.css" />
</head>
<body>
<div id="hud">
  <div class="row">
    <div class="pill" id="hpPill">HP: <span id="hp">100</span></div>
    <div class="pill" id="ammoPill">Ammo: <img id="weaponIcon" class="wicon" alt="" /> <span id="weapon">Rifle</span> ‚Äî <span id="ammo">30</span>/<span id="mag">60</span></div>
    <div class="pill">Score: <span id="score">0</span></div>
    <div class="pill">Best: <span id="best">0</span></div>
    <div class="pill" id="combo"><span id="comboLabel">Combo: x1.0</span><div id="comboBar"></div></div>
    <div class="pill" id="wavePill">Wave: <span id="wave">1</span> <span id="remainingWrap" class="tiny" style="margin-left:6px">(<span id="remaining">0</span> left)</span> <span id="hydraWrap" class="tiny" style="margin-left:6px; display:none">(Hydra <span id="hydraCount">0/0</span>)</span><div id="waveBar"></div></div>
    <div class="pill" id="stamina">Stamina<div id="staminaBar"></div></div>
    <div class="pill tiny" id="seedPill">Seed: <span id="seed"></span>
      <button class="mini" id="copySeed" title="Copy share URL">Copy</button>
      <button class="mini" id="newSeed" title="New seed">New</button>
    </div>
    <div class="pill tiny" id="fpsPill">FPS: <span id="fps">0</span></div>
    <div class="pill" id="mute">üîä</div>
  </div>
  <div class="row" style="justify-content:flex-end">
    <div class="pill tiny" id="desktopHelp">WASD move ‚Ä¢ Mouse aim ‚Ä¢ Click shoot ‚Ä¢ R reload ‚Ä¢ Shift sprint ‚Ä¢ Ctrl crouch ‚Ä¢ Space jump ‚Ä¢ P pause</div>
  </div>
</div>

<div id="crosshair">
  <div class="seg top"></div>
  <div class="seg bottom"></div>
  <div class="seg left"></div>
  <div class="seg right"></div>
</div>
<div id="hitmarker"></div>

<div id="bossHud" style="display:none">
  <div id="bossName" class="tiny"></div>
  <div class="bossBar"><div id="bossHpBar"></div></div>
</div>

<div id="toasts"></div>

<div id="newsTicker"></div>

<div id="story" style="display:none">
  <div class="card">
    <div id="storyText" class="storyText"></div>
    <div class="actions"><button class="primary" id="storyNext">Continue</button></div>
  </div>
  <style>
    #story{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,0.35); pointer-events:auto; z-index:5; }
    #story .card{ background:#ffffffee; border-radius:18px; padding:16px; width:min(92%,520px); box-shadow:0 20px 70px #00000055; }
    #story .storyText{ font-weight:700; line-height:1.4; margin-bottom:12px; }
    #story .actions{ display:flex; justify-content:flex-end; }
  </style>
</div>

<div id="promoPulse"></div>

<div id="offer" style="display:none">
  <div class="card">
    <h3>Armory Offer</h3>
    <div id="offerChoices" class="choices"></div>
    <div class="actions"><button class="secondary" id="offerDecline">Keep current (+reserve)</button></div>
  </div>
  <style>
    #offer{ position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,0.35); pointer-events:auto; }
    #offer .card{ background:#ffffffee; border-radius:18px; padding:16px; width:min(92%,520px); box-shadow:0 20px 70px #00000055; text-align:center }
    #offer .choices{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin:10px 0 }
    .choice{ display:flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; border:2px solid #00000018; background:#fff; cursor:pointer; box-shadow:0 8px 24px #00000022; }
    .choice img{ width:28px; height:28px }
    .wicon{ width:16px; height:16px; vertical-align:middle; margin-right:4px }
  </style>
</div>

<div id="center"><div id="panel">
  <h1>Quarantine of <span>Joy</span></h1>
  <div>Meme-fueled shooter. Hijack feeds, raise hype, roast the Bureau.</div>
  <div style="display:flex; gap:10px; justify-content:center; margin:12px 0; flex-wrap:wrap">
    <div class="pill">Waves of bots</div>
    <div class="pill">Hitscan rifle + tracers</div>
    <div class="pill">Headshot bonus</div>
    <div class="pill">Procedural arena</div>
  </div>
  <div style="display:flex; justify-content:center; gap:8px; margin:12px 0; flex-wrap:wrap">
    <select id="musicSelect" class="secondary startSelect" style="cursor:pointer; border:0; border-radius:14px; padding:12px 16px; font-weight:900; box-shadow:0 12px 36px #0000002a;">
      <option value="library">chatGPT 5 music</option>
      <option value="suno">Suno Remix</option>
    </select>
    <select id="arenaShape" class="secondary startSelect" style="cursor:pointer; border:0; border-radius:14px; padding:12px 16px; font-weight:900; box-shadow:0 12px 36px #0000002a;">
      <option value="box">Box Arena</option>
      <option value="circle">Circle Arena</option>
      <option value="diamond">Diamond Arena</option>
      <option value="triangle">Triangle Arena</option>
      <option value="pi">–ü Arena</option>
    </select>
  </div>
  <div style="display:flex; gap:12px; justify-content:center; flex-wrap:wrap">
    <button class="primary" id="play">‚ñ∂Ô∏è Play</button>
    <button class="secondary" id="retry" style="display:none">üîÅ Retry</button>
  </div>
  <div class="tiny" style="margin-top:10px; text-align:center">Quality presets</div>
  <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:6px">
    <button class="secondary" id="qLow" title="aa=off, shadows=off, auto DPR">Low</button>
    <button class="secondary" id="qMed" title="aa=off, shadows=off, auto DPR + ACES">Medium</button>
    <button class="secondary" id="qHigh" title="aa=on, shadows=on">High</button>
    <button class="secondary" id="qUltra" title="aa=on, shadows=on (max)" >Ultra</button>
  </div>
  <div class="tiny" style="margin-top:8px" id="startTip">Click Play, then click to lock the mouse.</div>
</div></div>

<!-- Loading overlay from performance branch -->
<div id="loading" style="position:fixed; inset:0; display:grid; place-items:center; background:#0b1220; color:#fff; z-index:9999">
  <div style="width:min(92%,520px); text-align:center">
    <div style="font-weight:700; margin-bottom:10px">Loading shaders &amp; assets‚Ä¶</div>
    <div id="loadingBarWrap" style="height:10px; background:#222; border-radius:8px; overflow:hidden">
      <div id="loadingBar" style="height:100%; width:0%; background:#22c55e; transition:width 0.15s ease"></div>
    </div>
    <div id="loadingText" class="tiny" style="margin-top:8px; opacity:0.85">0%</div>
  </div>
</div>

<!-- Mobile controls from main branch -->
<script>
  window.IS_MOBILE = window.matchMedia('(pointer:coarse)').matches;
  if (window.IS_MOBILE) {
    const m = document.createElement('div');
    m.id = 'mobileControls';
    m.innerHTML = `
      <div id="joystick" class="joy"><div class="base"></div><div class="knob"></div></div>
      <div id="actionButtons">
        <button id="btnFire">üî•</button>
        <button id="btnJump">‚§¥Ô∏è</button>
        <button id="btnReload">üîÑ</button>
      </div>`;
    document.body.appendChild(m);
    const help = document.getElementById('desktopHelp');
    if (help) help.style.display = 'none';
    const hud = document.getElementById('hud');
    if (hud) {
      const row = document.createElement('div');
      row.className = 'row';
      row.style.justifyContent = 'flex-end';
      row.innerHTML = '<div class="pill tiny" id="mobileHelp">Move: joystick ‚Ä¢ Shoot: üî• ‚Ä¢ Jump: ‚§¥Ô∏è</div>';
      hud.appendChild(row);
      const hideHelp = () => document.getElementById('mobileHelp')?.remove();
      setTimeout(hideHelp, 5000);
      ['joystick','btnFire','btnJump','btnReload'].forEach(id=>{
        document.getElementById(id)?.addEventListener('touchstart', hideHelp, {once:true});
      });
    }
  }
</script>

<!-- Use the versioned entry from performance branch -->
<script type="module" src="src/main.js?v=4"></script>
</body>
</html>
